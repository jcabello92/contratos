<h1>Documentos</h1>

<!-- Filtros y búsqueda -->
<div style="display: flex; align-items: center; gap: 150px;">
  <div>
    <label for="campoOrden" style="margin-right: 10px;">Selecciona una opción:</label>
    <select id="campoOrden" [(ngModel)]="campoOrden" class="combo-box">
      <option value="nombre">Nombre</option>
      <option value="FechaSubida">Fecha de Subida</option>
      <option value="HoraSubida">Hora de Subida</option>
    </select>
  </div>
  <div>
    <label for="orden" style="margin-right: 10px;">Seleccione la siguiente opción:</label>
    <select id="orden" [(ngModel)]="orden" class="combo-box">
      <option value="asc">De Primero al Último</option>
      <option value="desc">De Último al Primero</option>
    </select>
  </div>
  <button class="combo-box" (click)="filtrarDocumentos()">Buscar</button>
</div>

<div style="height: 30px"></div>

<div class="botonesCrud-container">
  <button class="botonesCrud" (click)="abrirModalDocumentosCrear()">Crear Documento</button>
  <button class="botonesCrud" (click)="actualizarDocumento()">Actualizar Documento</button>
  <button class="botonesCrud" (click)="eliminarDocumento()">Eliminar Documento</button>
</div>

<div style="height: 30px"></div>

<table>
  <thead>
  <tr class="encabezado">
    <td>Selector</td>
    <td>ID</td>
    <td>Nombre</td>
    <td>Fecha de Subida</td>
    <td>Hora de Subida</td>
    <td>Tipo de documento</td>
    <td>Contrato al que está vinculado</td>
    <td>Acceso</td>
  </tr>
  </thead>
  <tbody>
  <tr *ngFor="let documento of documentos; let i = index">
    <td>
      <input type="checkbox" [checked]="documentoSeleccionado[i]" (change)="onCheckboxChange(i)" />
    </td>
    <td>{{ documento.id }}</td>
    <td>{{ documento.nombre }}</td>
    <td>{{ documento.fecha_subida }}</td>
    <td>{{ documento.hora_subida }}</td>
    <td>{{ documento.tipo_documento }}</td>
    <td>{{ documento.contrato }}</td>
    <td>
      <button class="botonesCrud" (click)="descargarDocumento(documento)">Acceso al documento</button>
    </td>
  </tr>
  </tbody>
</table>


<div style="height: 50px"></div>

<!-- Paginación -->
<div style="display: flex; justify-content: space-between; width: 100%;">
  <button class="buttons" style="flex: 1; margin-right: 10px; " (click)="gestionPaginas('anterior')">Página Anterior</button>
  <button class="buttons" style="flex: 1;" (click)="gestionPaginas('siguiente')">Página Siguiente</button>
</div>

<!-- ==================================================== MODALES ======================================================-->

<!-- Modal Crear -->
<div id="modalCrear" class="modal" [ngClass]="{'show': modalAbiertoCrear}">
  <div class="modal-content">
    <h2>Crear Documento</h2>

    <label>Nombre:</label>
    <input type="text" [(ngModel)]="nuevoDocumento.nombre" required>

    <label>Fecha de subida:</label>
    <input type="date" [(ngModel)]="nuevoDocumento.fecha_subida" required>

    <label>Hora de subida:</label>
    <input type="time" [(ngModel)]="nuevoDocumento.hora_subida" required>

    <!-- Tipo de Documento -->
    <label>Tipo de Documento:</label>
    <select [(ngModel)]="nuevoDocumento.tipo_documento" name="tipo_documento" required>
      <option *ngFor="let tipo of tiposDocumentos" [ngValue]="tipo">{{ tipo.nombre }}</option>
    </select>

    <!-- Contrato -->
    <label>Contrato Relacionado:</label>
    <select [(ngModel)]="nuevoDocumento.contrato" name="contrato" required>
      <option *ngFor="let contrato of contratos" [ngValue]="contrato">{{ contrato.nombre }}</option>
    </select>

    <!-- Selección de Archivo -->
    <label>Archivo:</label>
    <input id="fileInput" type="file" (change)="onFileSelected($event)" hidden>
    <button class="buttons" (click)="abrirSelectorArchivos()">Seleccionar Archivo</button>
    <p *ngIf="selectedFile">Archivo seleccionado: {{ selectedFile.name }}</p>

    <div class="modal-buttons">
      <button class="buttons"  type="button" (click)="cerrarModalDocumentosCrear()">Cancelar</button>
      <button class="buttons"  type="submit" (click)="crearDocumento()">Crear Documento</button>
    </div>
  </div>
</div>


<!-- Modal Actualizar Documento -->
<div id="modalActualizar" class="modal" [ngClass]="{'show': showModalEditar}">
  <div class="modal-content">
    <h2>Actualizar Documento</h2>
    <form (ngSubmit)="actualizarElDocumento()">
      <label>Nombre:</label>
      <input type="text" [(ngModel)]="nuevoDocumento.nombre" name="nombre" required>

      <label>Fecha de Subida:</label>
      <input type="date" [(ngModel)]="nuevoDocumento.fecha_subida" name="fecha_subida" required>

      <label>Hora de Subida:</label>
      <input type="time" [(ngModel)]="nuevoDocumento.hora_subida" name="hora_subida" required>

      <!-- Tipo de Documento con combobox -->
      <label>Tipo de Documento:</label>
      <select [(ngModel)]="nuevoDocumento.tipo_documento" name="tipo_documento" required>
        <option *ngFor="let tipo of tiposDocumentos" [ngValue]="tipo">{{ tipo.nombre }}</option>
      </select>

      <!-- Contrato con combobox -->
      <label>Contrato:</label>
      <select [(ngModel)]="nuevoDocumento.contrato" name="contrato" required>
        <option *ngFor="let contrato of contratos" [ngValue]="contrato">{{ contrato.nombre }}</option>
      </select>

      <div class="modal-buttons">
        <button class="buttons" type="button" (click)="cancelarActualizacion()">Cancelar</button>
        <button class="buttons" type="submit">Actualizar</button>
      </div>
    </form>
  </div>
</div>


<!-- Modal de eliminación de documentos -->
<div id="modalEliminar" class="modal" [ngClass]="{'show': modalAbiertoEliminar}">
  <div class="modal-content">
    <span class="cerrar" (click)="cerrarModalEliminar()">&times;</span>
    <h2>¿Está seguro que desea eliminar los siguientes documentos?</h2>
    <ul>
      <li *ngFor="let documento of documentosParaEliminar">
        (Documento: {{ documento.nombre }})
      </li>
    </ul>
    <div class="botones">
      <button type="button" (click)="cerrarModalEliminar()">Cancelar</button>
      <button type="button" (click)="confirmarEliminacion()">Confirmar</button>
    </div>
  </div>
</div>
