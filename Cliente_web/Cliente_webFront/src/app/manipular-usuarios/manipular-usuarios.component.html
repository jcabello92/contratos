<div class="tabla-usuarios">
  <h1>Trabajar con los Usuarios</h1>

  <!-- Botones de acción -->
  <div class="botones-usuarios">
    <button (click)="openModal()">Crear Usuario</button>
    <button (click)="abrirPrimerModalActualizar()">Actualizar un usuario</button>
    <button class="btn btn-danger" (click)="abrirModalEliminar()">Borrar un Usuario</button>
  </div>

  <!-- Tabla para mostrar usuarios -->
  <div class="tabla-contenedor">
    <table *ngIf="usuarios.length > 0">
      <thead>
      <tr>
        <th>ID</th>
        <th>Usuario</th>
        <th>RUT</th>
        <th>Nombre</th>
        <th>Correo</th>
        <th>Rol</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let usuario of usuarios">
        <td>{{ usuario.id }}</td>
        <td>{{ usuario.usuario }}</td>
        <td>{{ usuario.rut }}</td>
        <td>{{ usuario.nombre }}</td>
        <td>{{ usuario.correo }}</td>
        <td>{{ usuario.rol }}</td>
      </tr>
      </tbody>
    </table>
    <p *ngIf="usuarios.length === 0" class="mensaje-sin-usuarios">
      No se han encontrado usuarios.
    </p>
  </div>
</div>



<!-- =========================================== MODALES ================================================== -->

<!-- Modal de crear usuario -->
<div class="modal" tabindex="-1" [ngClass]="{ 'show': showModal }" [ngStyle]="{ display: showModal ? 'block' : 'none' }">
  <div class="modal-dialog">
    <div class="modal-content custom-modal-content">
      <div class="modal-header custom-modal-header">
        <h5 class="modal-title">Crear Nuevo Usuario</h5>
        <button type="button" class="btn-close custom-btn-close" aria-label="Close" (click)="closeModal()"></button>
      </div>
      <div class="modal-body custom-modal-body">
        <form>
          <div class="mb-3">
            <label for="usuario" class="form-label">Usuario</label>
            <input type="text" class="form-control" id="usuario" [(ngModel)]="nuevoUsuario.usuario" name="usuario" />
          </div>
          <div class="mb-3">
            <label for="contrasena" class="form-label">Contraseña</label>
            <input type="password" class="form-control" id="contrasena" [(ngModel)]="nuevoUsuario.contrasena" name="contrasena" />
          </div>
          <div class="mb-3">
            <label for="rut" class="form-label">RUT</label>
            <input type="text" class="form-control" id="rut" [(ngModel)]="nuevoUsuario.rut" name="rut" />
          </div>
          <div class="mb-3">
            <label for="nombre" class="form-label">Nombre</label>
            <input type="text" class="form-control" id="nombre" [(ngModel)]="nuevoUsuario.nombre" name="nombre" />
          </div>
          <div class="mb-3">
            <label for="apellido" class="form-label">Apellido</label>
            <input type="text" class="form-control" id="apellido" [(ngModel)]="nuevoUsuario.apellido" name="apellido" />
          </div>
          <div class="mb-3">
            <label for="telefono" class="form-label">Teléfono</label>
            <input type="text" class="form-control" id="telefono" [(ngModel)]="nuevoUsuario.telefono" name="telefono" />
          </div>
          <div class="mb-3">
            <label for="correo" class="form-label">Correo</label>
            <input type="email" class="form-control" id="correo" [(ngModel)]="nuevoUsuario.correo" name="correo" />
          </div>
          <div class="mb-3">
            <label for="rol" class="form-label">Rol</label>
            <select class="form-select" id="rol" [(ngModel)]="nuevoUsuario.rol" name="rol">
              <option value="1">Administrador</option>
              <option value="2">Usuario</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer custom-modal-footer">
        <button type="button" class="btn custom-btn-cancel" (click)="closeModal()">Cancelar</button>
        <button type="button" class="btn custom-btn-create" (click)="crearUsuario()">Crear</button>
      </div>
    </div>
  </div>
</div>

<!-- Primer Modal: Selección de usuario -->
<div class="modal" *ngIf="mostrarPrimerModal">
  <div class="modal-contenido">
    <h2>Selecciona un usuario</h2>
    <ul>
      <li *ngFor="let usuario of usuarios" (click)="seleccionarUsuario(usuario.id)">
        {{ usuario.nombre }} - {{ usuario.correo }}
      </li>
    </ul>
    <div class="modal-botones">
      <button (click)="cerrarPrimerModal()">Cancelar</button>
      <button [disabled]="!usuarioSeleccionado" (click)="abrirSegundoModal()">Actualizar</button>
    </div>
  </div>
</div>

<!-- Segundo Modal: Detalle del usuario -->
<div class="modal-container" *ngIf="mostrarSegundoModal">
  <div class="modal">
    <h2 class="modal-title">Actualizar Usuario</h2>
    <div class="modal-grid">
      <label>
        <span>Usuario:</span>
        <input type="text" [(ngModel)]="usuarioDetalle.usuario" class="input-field" />
      </label>
      <label>
        <span>Rut:</span>
        <input type="text" [(ngModel)]="usuarioDetalle.rut" class="input-field" />
      </label>
      <label>
        <span>Nombre:</span>
        <input type="text" [(ngModel)]="usuarioDetalle.nombre" class="input-field" />
      </label>
      <label>
        <span>Apellido:</span>
        <input type="text" [(ngModel)]="usuarioDetalle.apellido" class="input-field" />
      </label>
      <label>
        <span>Teléfono:</span>
        <input type="text" [(ngModel)]="usuarioDetalle.telefono" class="input-field" />
      </label>
      <label>
        <span>Correo:</span>
        <input type="email" [(ngModel)]="usuarioDetalle.correo" class="input-field" />
      </label>
      <label class="grid-span">
        <span>Rol:</span>
        <input type="text" [(ngModel)]="usuarioDetalle.rol" class="input-field" />
      </label>
    </div>
    <div class="modal-actions">
      <button class="btn-cancel" (click)="cerrarSegundoModal()">Cancelar</button>
      <button class="btn-submit" (click)="actualizarUsuario()">Actualizar Usuario</button>
    </div>
  </div>
</div>

<!-- Primer modal para ingresar el ID -->
<div
  class="modal"
  *ngIf="mostrarPrimerModal"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Eliminar Usuario</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="cerrarModalEliminar()"></button>
      </div>
      <div class="modal-body">
        <p>Ingrese el ID del usuario que desea eliminar:</p>
        <input
          type="number"
          class="form-control"
          [(ngModel)]="usuarioSeleccionado"
        />
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="cerrarModalEliminar()">Cancelar</button>
        <button class="btn btn-primary" (click)="validarUsuarioEliminar()">Eliminar</button>
      </div>
    </div>
  </div>
</div>

<!-- Segundo modal para confirmar la eliminación -->
<div
  class="modal"
  *ngIf="mostrarSegundoModal"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Confirmar Eliminación</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="cerrarModalEliminar()"></button>
      </div>
      <div class="modal-body">
        <p>
          ¿Está seguro de querer eliminar al usuario con ID:
          <strong>{{ usuarioSeleccionado }}</strong>?
        </p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="cerrarModalEliminar()">Cancelar</button>
        <button class="btn btn-danger" (click)="confirmarEliminarUsuario()">Eliminar Usuario</button>
      </div>
    </div>
  </div>
</div>





